# â›©ï¸ NostrShrine

Nosträ¸Šã§å‹•ä½œã™ã‚‹ã€å®Œå…¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç¥ç¤¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚å‚æ‹è¨˜éŒ²ã‚„ãŠã¿ãã˜ã‚’Nostrã®ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚

## ğŸŒŸ ç‰¹å¾´

- **ğŸ™ å‚æ‹æ©Ÿèƒ½**: å‚æ‹è¨˜éŒ²ã‚’Nostr (kind 3081) ã«ä¿å­˜
- **ğŸ´ ãŠã¿ãã˜**: äº‹å‰ç”Ÿæˆã•ã‚ŒãŸãŠã¿ãã˜ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å¼•ã„ã¦ã€çµæœã‚’Nostrã«æŠ•ç¨¿å¯èƒ½
- **â±ï¸ ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³åˆ¶é™**: ãŠã¿ãã˜ã¯æŒ‡å®šæ™‚é–“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ60åˆ†ï¼‰ã”ã¨ã«1å›å¼•ã‘ã‚‹æ™‚é–“ãƒ™ãƒ¼ã‚¹åˆ¶é™
- **ğŸ“œ å‚æ‹å±¥æ­´**: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‚æ‹è¨˜éŒ²ã‚’ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä»˜ãã§è¡¨ç¤º
- **ğŸ” NIP-07èªè¨¼**: ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ï¼ˆAlby, nos2xç­‰ï¼‰ã«ã‚ˆã‚‹å®‰å…¨ãªèªè¨¼
- **âš¡ å®Œå…¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¸è¦ã€ã™ã¹ã¦Nostrãƒªãƒ¬ãƒ¼çµŒç”±
- **ğŸ’¾ IndexedDBã‚­ãƒ£ãƒƒã‚·ãƒ¥**: ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦é«˜é€Ÿè¡¨ç¤º
- **ğŸ¦€ rust-nostr WASM**: é«˜æ€§èƒ½ãªrust-nostrã‚’WebAssemblyã§åˆ©ç”¨
- **ğŸ¨ ç¥ç¤¾ãƒ†ãƒ¼ãƒ**: æœ±è‰²ã¨é‡‘è‰²ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸå’Œã®ãƒ‡ã‚¶ã‚¤ãƒ³
- **ğŸ¤– LLMç”Ÿæˆ**: ç®¡ç†è€…ã¯OpenAI APIã‚’ä½¿ã£ã¦ãŠã¿ãã˜ã‚’è‡ªå‹•ç”Ÿæˆï¼ˆé‹å‹¢åˆ¥ãƒ»å‰²åˆæŒ‡å®šå¯èƒ½ï¼‰

## ğŸ“¦ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React + TypeScript + Vite
- **UI**: Material-UI (MUI)
- **Nostr**: rust-nostr (WASMãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è‡ªä½œ)
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: IndexedDB (idb-keyval)
- **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: React Router
- **LLM**: OpenAI API (gpt-4o-mini)
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: GitHub Pages

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦ãªç’°å¢ƒ

- Node.js 20+
- pnpm 9+
- Rust (stable)
- wasm-pack

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/kojira/NostrShrine.git
cd NostrShrine

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install

# WASMã‚’ãƒ“ãƒ«ãƒ‰
cd rust-nostr-wasm
wasm-pack build --target web --out-dir ../src/wasm
cd ..

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
cp .env.example .env
# .envã‚’ç·¨é›†ã—ã¦ç®¡ç†è€…ã®å…¬é–‹éµã‚’è¨­å®šï¼ˆç®¡ç†è€…æ©Ÿèƒ½ã‚’ä½¿ã†å ´åˆã®ã¿ï¼‰
```

### é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
pnpm run dev
```

http://localhost:5173 ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•ã—ã¾ã™ã€‚

### ãƒ“ãƒ«ãƒ‰

```bash
pnpm run build
```

## ğŸ”§ ç’°å¢ƒå¤‰æ•°

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã®å¤‰æ•°ã‚’è¨­å®šã§ãã¾ã™ï¼š

```env
# ç®¡ç†è€…ã®å…¬é–‹éµï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°æŒ‡å®šå¯èƒ½ï¼‰
VITE_ADMIN_PUBKEYS=npub1xxx,npub1yyy

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒ¬ãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: wss://r.kojira.ioï¼‰
VITE_DEFAULT_RELAY=wss://r.kojira.io
```

### GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤

GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã® **Settings > Secrets and variables > Actions** ã® **Variables** ã‚¿ãƒ–ã§ä»¥ä¸‹ã®å¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

- `VITE_ADMIN_PUBKEYS`: ç®¡ç†è€…ã®å…¬é–‹éµï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰
  - ä¾‹: `npub1abc...,npub1def...` ã¾ãŸã¯ `hex1,hex2`
- `VITE_DEFAULT_RELAY`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒ¬ãƒ¼
  - ä¾‹: `wss://r.kojira.io`

ã“ã‚Œã‚‰ã®ç’°å¢ƒå¤‰æ•°ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«åŸ‹ã‚è¾¼ã¾ã‚Œã¾ã™ã€‚

**è¨­å®šæ‰‹é †:**
1. ãƒªãƒã‚¸ãƒˆãƒªã® **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. **Variables** ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. **New repository variable** ã§ä¸Šè¨˜ã®å¤‰æ•°ã‚’è¿½åŠ 

## ğŸ“± ä½¿ã„æ–¹

### ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼

1. NIP-07å¯¾å¿œã®ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ï¼ˆAlby, nos2xç­‰ï¼‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦èªè¨¼
3. **å‚æ‹ã™ã‚‹**: å‚æ‹è¨˜éŒ²ã‚’Nostrã«æŠ•ç¨¿
4. **ãŠã¿ãã˜ã‚’å¼•ã**: äº‹å‰ç”Ÿæˆã•ã‚ŒãŸãŠã¿ãã˜ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å¼•ãï¼ˆè¨­å®šã•ã‚ŒãŸæ™‚é–“é–“éš”ã”ã¨ã«1å›ï¼‰
5. **å‚æ‹å±¥æ­´ã‚’è¦‹ã‚‹**: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‚æ‹è¨˜éŒ²ã‚’ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä»˜ãã§ç¢ºèª

### ç®¡ç†è€…

ç®¡ç†è€…ã¨ã—ã¦èªè¨¼ã™ã‚‹ã¨ã€`/admin`ãƒšãƒ¼ã‚¸ã§è¿½åŠ ã®æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š

1. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š**: ãŠã¿ãã˜ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³æ™‚é–“ï¼ˆåˆ†ï¼‰ã‚’è¨­å®š
2. **ãŠã¿ãã˜ç”Ÿæˆ**: OpenAI APIã‚­ãƒ¼ã‚’è¨­å®šã—ã€LLMã§ãŠã¿ãã˜ã‚’ç”Ÿæˆ
   - é‹å‹¢ã‚’æŒ‡å®šã—ã¦ç”Ÿæˆï¼ˆå¤§å‰ã€ä¸­å‰ã€å°å‰ã€å‰ã€æœ«å‰ã€å‡¶ã€å¤§å‡¶ï¼‰
   - é‹å‹¢ã®å‰²åˆã‚’æŒ‡å®šã—ã¦ä¸€æ‹¬ç”Ÿæˆ
3. **ãŠã¿ãã˜ä¸€è¦§**: ç”Ÿæˆæ¸ˆã¿ã®ãŠã¿ãã˜ã‚’ãƒšãƒ¼ã‚¸ãƒ³ã‚°è¡¨ç¤ºã€ãƒ‡ãƒãƒƒã‚°ç”¨ã«JSONç¢ºèªå¯èƒ½

## ğŸ“‹ Nostrã‚¤ãƒ™ãƒ³ãƒˆä»•æ§˜

### kind 3081: å‚æ‹è¨˜éŒ²

```json
{
  "kind": 3081,
  "content": "{\"shrine_name\":\"NostrShrine\",\"message\":\"å‚æ‹ã—ã¾ã—ãŸ\",\"visited_at\":1234567890}",
  "tags": [
    ["shrine", "NostrShrine"]
  ]
}
```

### kind 1: ãŠã¿ãã˜çµæœæŠ•ç¨¿

```json
{
  "kind": 1,
  "content": "ğŸ´ ãŠã¿ãã˜ã®çµæœ\n\né‹å‹¢: å¤§å‰\n\n...",
  "tags": [
    ["t", "NostrShrine"],
    ["t", "ãŠã¿ãã˜"],
    ["fortune", "å¤§å‰"]
  ]
}
```

### kind 30394: ãŠã¿ãã˜ãƒ‡ãƒ¼ã‚¿ï¼ˆç®¡ç†è€…ãŒäº‹å‰ç”Ÿæˆï¼‰

```json
{
  "kind": 30394,
  "content": "{\"fortune\":\"å¤§å‰\",\"general\":\"...\",\"love\":\"...\",\"money\":\"...\"}",
  "tags": [
    ["d", "omikuji-{unique-id}"],
    ["fortune", "å¤§å‰"]
  ]
}
```

### kind 10381: ç®¡ç†è€…ãƒªã‚¹ãƒˆ

```json
{
  "kind": 10381,
  "content": "{\"admins\":[\"pubkey1\",\"pubkey2\"],\"updated_at\":1234567890}",
  "tags": [
    ["d", "nostrshrine-admins"],
    ["p", "pubkey1"],
    ["p", "pubkey2"]
  ]
}
```

### kind 10394: ã‚¢ãƒ—ãƒªè¨­å®š

```json
{
  "kind": 10394,
  "content": "{\"omikujiCooldownMinutes\":60,\"relays\":[\"wss://r.kojira.io\"]}",
  "tags": [
    ["d", "nostrshrine-settings"]
  ]
}
```

### kind 0: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆå‚æ‹å±¥æ­´ã«è¡¨ç¤ºï¼‰

```json
{
  "kind": 0,
  "content": "{\"name\":\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å\",\"display_name\":\"è¡¨ç¤ºå\",\"picture\":\"https://...\"}",
  "tags": []
}
```

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
NostrShrine/
â”œâ”€â”€ rust-nostr-wasm/        # Rust WASM ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ lib.rs          # rust-nostr ã®ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â””â”€â”€ Cargo.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/         # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ admin/          # ç®¡ç†è€…ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Settings.tsx        # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
â”‚   â”‚   â”‚   â”œâ”€â”€ OmikujiGenerator.tsx # ãŠã¿ãã˜ç”Ÿæˆ
â”‚   â”‚   â”‚   â””â”€â”€ OmikujiList.tsx     # ãŠã¿ãã˜ä¸€è¦§
â”‚   â”‚   â”œâ”€â”€ ShrineVisit.tsx # å‚æ‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ Omikuji.tsx     # ãŠã¿ãã˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ ShrineHistory.tsx # å‚æ‹å±¥æ­´
â”‚   â”œâ”€â”€ pages/              # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ HomePage.tsx    # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”‚   â””â”€â”€ AdminPage.tsx   # ç®¡ç†è€…ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ contexts/           # React Context
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx # èªè¨¼ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ RelayContext.tsx # ãƒªãƒ¬ãƒ¼æ¥ç¶šç®¡ç†
â”‚   â”‚   â””â”€â”€ AdminContext.tsx # ç®¡ç†è€…æ¨©é™ç®¡ç†
â”‚   â”œâ”€â”€ hooks/              # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ useOmikuji.ts         # ãŠã¿ãã˜å¼•ãæ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ useOmikujiGenerator.ts # ãŠã¿ãã˜ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ useOmikujiList.ts     # ãŠã¿ãã˜ä¸€è¦§
â”‚   â”‚   â”œâ”€â”€ useShrineHistory.ts   # å‚æ‹å±¥æ­´
â”‚   â”‚   â”œâ”€â”€ useSettings.ts        # è¨­å®šå–å¾—
â”‚   â”‚   â””â”€â”€ useAdmin.ts           # ç®¡ç†è€…æ¨©é™
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ nostr/          # Nostrã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts   # WASMãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ nip07.ts    # NIP-07å®Ÿè£…
â”‚   â”‚   â”‚   â”œâ”€â”€ relay.ts    # ãƒªãƒ¬ãƒ¼æ¥ç¶š
â”‚   â”‚   â”‚   â”œâ”€â”€ events.ts   # ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
â”‚   â”‚   â”‚   â””â”€â”€ cachedRelay.ts # ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±åˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ cache/          # ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹
â”‚   â”‚       â”œâ”€â”€ eventCache.ts   # ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”‚   â”‚       â””â”€â”€ profileCache.ts # ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ llm/            # LLMçµ±åˆ
â”‚   â”‚       â”œâ”€â”€ types.ts
â”‚   â”‚       â”œâ”€â”€ openai.ts   # OpenAIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ constants.ts    # å®šæ•°å®šç¾©
â”‚   â””â”€â”€ wasm/               # ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸWASMï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml      # GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤
â””â”€â”€ vite.config.ts
```

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯
2. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ (`git checkout -b feature/amazing-feature`)
3. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add some amazing feature'`)
4. ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ğŸ™ è¬è¾

- [rust-nostr](https://github.com/rust-nostr/nostr) - é«˜æ€§èƒ½ãªNostrãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- [Material-UI](https://mui.com/) - ç¾ã—ã„UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [Nostr Protocol](https://github.com/nostr-protocol/nostr) - åˆ†æ•£å‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«

---

Made with â¤ï¸ and â›©ï¸
